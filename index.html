<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Admin  Panel | Manage Apps</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- VARIABLES --- */
        :root {
            --bg-dark: #0f1014;
            --bg-panel: #1b1e26;
            --primary: #00d4ff;
            --primary-dark: #009ec4;
            --danger: #ff4757;
            --warning: #ffa502;
            --text-main: #fff;
            --text-muted: #8898aa;
            --border: rgba(255,255,255,0.1);
        }

        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; outline: none; }
        body { margin: 0; background-color: var(--bg-dark); color: var(--text-main); height: 100vh; overflow: hidden; }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            display: flex; height: 100vh; justify-content: center; align-items: center;
            background: radial-gradient(circle at top right, #003b55 0%, #0f1014 60%);
            z-index: 9999; position: absolute; width: 100%; top: 0; left: 0;
        }

        .login-box {
            background: rgba(27, 30, 38, 0.9); padding: 40px; border-radius: 12px;
            width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid var(--border); text-align: center; backdrop-filter: blur(10px);
        }
        .login-box h2 { margin-bottom: 20px; color: var(--primary); letter-spacing: 1px; }

        /* --- DASHBOARD LAYOUT --- */
        #dashboard { display: none; height: 100vh; display: flex; }

        /* Sidebar */
        .sidebar {
            width: 250px; background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 20px;
        }

        .brand { font-size: 22px; font-weight: 700; color: var(--primary); margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .menu-item {
            padding: 12px 15px; margin-bottom: 10px; border-radius: 8px;
            color: var(--text-muted); cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; gap: 10px;
        }
        .menu-item.active { background: rgba(0, 212, 255, 0.1); color: var(--primary); }
        .logout-btn { margin-top: auto; color: var(--danger); }
        .logout-btn:hover { background: rgba(255, 71, 87, 0.1); }

        /* Main Content */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; background-color: var(--bg-dark); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .user-info { font-size: 14px; color: var(--text-muted); }

        /* --- EDITOR FORM --- */
        .editor-container { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 40px; }
        
        .card-panel { background: var(--bg-panel); padding: 25px; border-radius: 12px; border: 1px solid var(--border); }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: var(--text-muted); font-size: 12px; margin-bottom: 8px; text-transform: uppercase; }
        
        input, textarea {
            width: 100%; background: #0f1014; border: 1px solid var(--border);
            padding: 12px 15px; color: #fff; border-radius: 6px; transition: 0.3s;
        }
        input:focus, textarea:focus { border-color: var(--primary); }

        .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        /* Buttons */
        .btn-primary {
            width: 100%; padding: 15px; background: var(--primary); color: #000;
            border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s;
        }
        .btn-primary:hover { background: var(--primary-dark); }

        /* Edit Mode specific buttons */
        .edit-controls { display: none; gap: 10px; }
        .btn-update { flex: 1; background: var(--warning); color: #000; padding: 15px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .btn-cancel { width: 100px; background: #333; color: white; padding: 15px; border: none; border-radius: 8px; cursor: pointer; }

        /* --- PREVIEW --- */
        .preview-area { position: sticky; top: 20px; }
        .preview-card { background-color: #1b1e26; border-radius: 12px; overflow: hidden; width: 100%; max-width: 300px; margin: 0 auto; border: 1px solid rgba(255,255,255,0.1); }
        .preview-img-wrapper { width: 100%; padding-top: 56.25%; position: relative; background: #252830; }
        .preview-img-wrapper img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .preview-content { padding: 15px; }
        .preview-content h3 { margin: 0; color: #fff; font-size: 16px; }

        /* --- MANAGE APPS LIST --- */
        .manage-section { border-top: 1px solid var(--border); padding-top: 20px; }
        .manage-title { font-size: 18px; margin-bottom: 20px; font-weight: 600; }
        
        .app-item {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--bg-panel); padding: 15px; margin-bottom: 10px;
            border-radius: 8px; border: 1px solid var(--border); transition: 0.2s;
        }
        .app-item:hover { transform: translateX(5px); border-color: var(--primary); }
        
        .app-info { display: flex; align-items: center; gap: 15px; }
        .app-info img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; }
        .app-name { font-weight: 600; font-size: 16px; }

        .action-btns { display: flex; gap: 10px; }
        .btn-icon {
            width: 35px; height: 35px; border-radius: 5px; border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center; color: white;
        }
        .btn-edit { background: rgba(255, 165, 2, 0.2); color: var(--warning); }
        .btn-edit:hover { background: var(--warning); color: black; }
        .btn-delete { background: rgba(255, 71, 87, 0.2); color: var(--danger); }
        .btn-delete:hover { background: var(--danger); color: white; }

        /* Toast */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 4px; padding: 16px; position: fixed; z-index: 1000; right: 30px; bottom: 30px; border-left: 5px solid var(--primary); transform: translateY(100px); transition: transform 0.3s; }
        #toast.show { visibility: visible; transform: translateY(0); }
    </style>
</head>
<body>

    <div id="toast">Notification</div>

    <!-- 1. LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-box">
            <h2>Admin PANEL</h2>
            <div class="form-group"><input type="email" id="email" placeholder="admin@nexus.com"></div>
            <div class="form-group"><input type="password" id="password" placeholder="Password"></div>
            <button class="btn-primary" onclick="login()">LOGIN</button>
        </div>
    </div>

    <!-- 2. DASHBOARD -->
    <div id="dashboard">
        
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="brand"><i class="fas fa-code"></i> NEXUS</div>
            <div class="menu-item active"><i class="fas fa-tasks"></i> Manage Apps</div>
            <div class="menu-item logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="header">
                <h1>App Manager</h1>
                <div class="user-info">Developer Mode</div>
            </div>

            <div class="editor-container">
                
                <!-- INPUT FORM -->
                <div class="card-panel">
                    <h3 id="form-title" style="margin-top:0; color:var(--primary);">Add New App</h3>
                    
                    <div class="form-group">
                        <label>App Name</label>
                        <input type="text" id="appName" placeholder="e.g. Free Fire" oninput="updatePreview()">
                    </div>

                    <div class="row-2">
                        <div class="form-group">
                            <label>Logo URL</label>
                            <input type="text" id="appLogo" placeholder="https://image.com/logo.png" oninput="updatePreview()">
                        </div>
                        <div class="form-group">
                            <label>Download Link</label>
                            <!-- MANUAL LINK (No APK Upload) -->
                            <input type="text" id="appDownload" placeholder="Drive / MediaFire Link">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="appDesc" rows="3" placeholder="App description..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Screenshots (URLs)</label>
                        <div class="row-2" style="margin-bottom: 10px;">
                            <input type="text" id="sc1" placeholder="Screenshot 1">
                            <input type="text" id="sc2" placeholder="Screenshot 2">
                        </div>
                        <div class="row-2">
                            <input type="text" id="sc3" placeholder="Screenshot 3">
                            <input type="text" id="sc4" placeholder="Screenshot 4">
                        </div>
                    </div>

                    <!-- BUTTONS: Swap between Publish and Update -->
                    <button id="btn-publish" class="btn-primary" onclick="saveGame()">PUBLISH TO STORE</button>
                    
                    <div id="edit-controls" class="edit-controls">
                        <button class="btn-update" onclick="saveGame()">UPDATE APP</button>
                        <button class="btn-cancel" onclick="cancelEdit()">CANCEL</button>
                    </div>
                </div>

                <!-- LIVE PREVIEW -->
                <div class="preview-area">
                    <div style="text-align:center; color:#888; margin-bottom:10px; font-size:12px;">LIVE PREVIEW</div>
                    <div class="preview-card">
                        <div class="preview-img-wrapper">
                            <img id="prev-img" src="https://via.placeholder.com/300?text=Logo">
                        </div>
                        <div class="preview-content">
                            <h3 id="prev-title">App Name</h3>
                            <p style="color:#888; font-size:12px; margin:5px 0;">Action &bull; Free</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- MANAGE LIST SECTION -->
            <div class="manage-section">
                <div class="manage-title">Published Apps</div>
                <div id="apps-list">
                    <!-- Apps load here -->
                    <div style="text-align:center; color:#666;">Loading...</div>
                </div>
            </div>

        </div>
    </div>

    <!-- FIREBASE JAVASCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCn1FBaxDwbvC28VWXAcq557uCidl-JHy0",
            authDomain: "app-store-6b5d4.firebaseapp.com",
            databaseURL: "https://app-store-6b5d4-default-rtdb.firebaseio.com",
            projectId: "app-store-6b5d4",
            storageBucket: "app-store-6b5d4.firebasestorage.app",
            messagingSenderId: "55022892860",
            appId: "1:55022892860:web:f48865da1539854bf8d039"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // Variables to handle Edit Mode
        let currentEditId = null; 
        let allGamesData = {};

        // --- AUTH ---
        window.login = () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, email, pass)
                .then(() => showToast("Login Success", "success"))
                .catch(err => showToast(err.message, "error"));
        };
        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, user => {
            document.getElementById('login-screen').style.display = user ? 'none' : 'flex';
            document.getElementById('dashboard').style.display = user ? 'flex' : 'none';
        });

        // --- FETCH & DISPLAY APPS ---
        onValue(ref(db, 'games'), (snapshot) => {
            const list = document.getElementById('apps-list');
            list.innerHTML = ""; // Clear list
            const data = snapshot.val();
            allGamesData = data || {};

            if (data) {
                // Reverse array to show newest first
                Object.entries(data).reverse().forEach(([key, game]) => {
                    const item = document.createElement('div');
                    item.className = 'app-item';
                    item.innerHTML = `
                        <div class="app-info">
                            <img src="${game.logo}" onerror="this.src='https://via.placeholder.com/50'">
                            <div>
                                <div class="app-name">${game.name}</div>
                                <div style="font-size:12px; color:#888;">ID: ${key.substring(0,6)}...</div>
                            </div>
                        </div>
                        <div class="action-btns">
                            <button class="btn-icon btn-edit" onclick="editGame('${key}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteGame('${key}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            } else {
                list.innerHTML = "<div style='text-align:center; padding:20px; color:#666;'>No apps found.</div>";
            }
        });

        // --- SAVE (PUBLISH or UPDATE) ---
        window.saveGame = () => {
            const gameData = {
                name: document.getElementById('appName').value,
                logo: document.getElementById('appLogo').value,
                desc: document.getElementById('appDesc').value,
                sc1: document.getElementById('sc1').value,
                sc2: document.getElementById('sc2').value,
                sc3: document.getElementById('sc3').value,
                sc4: document.getElementById('sc4').value,
                download: document.getElementById('appDownload').value,
                timestamp: Date.now()
            };

            if(!gameData.name || !gameData.download) {
                showToast("Name and Link are required!", "error");
                return;
            }

            if (currentEditId) {
                // UPDATE EXISTING
                update(ref(db, 'games/' + currentEditId), gameData)
                    .then(() => {
                        showToast("App Updated!", "success");
                        cancelEdit();
                    })
                    .catch(err => showToast(err.message, "error"));
            } else {
                // CREATE NEW
                push(ref(db, 'games'), gameData)
                    .then(() => {
                        showToast("Published Successfully!", "success");
                        resetForm();
                    })
                    .catch(err => showToast(err.message, "error"));
            }
        };

        // --- EDIT LOGIC ---
        window.editGame = (key) => {
            currentEditId = key;
            const game = allGamesData[key];

            // Fill Form
            document.getElementById('appName').value = game.name;
            document.getElementById('appLogo').value = game.logo;
            document.getElementById('appDownload').value = game.download;
            document.getElementById('appDesc').value = game.desc;
            document.getElementById('sc1').value = game.sc1 || "";
            document.getElementById('sc2').value = game.sc2 || "";
            document.getElementById('sc3').value = game.sc3 || "";
            document.getElementById('sc4').value = game.sc4 || "";

            updatePreview();

            // Switch Buttons
            document.getElementById('btn-publish').style.display = 'none';
            document.getElementById('edit-controls').style.display = 'flex';
            document.getElementById('form-title').innerText = "Edit App: " + game.name;
            
            // Scroll to top
            document.querySelector('.main-content').scrollTop = 0;
        };

        window.cancelEdit = () => {
            currentEditId = null;
            resetForm();
            document.getElementById('btn-publish').style.display = 'block';
            document.getElementById('edit-controls').style.display = 'none';
            document.getElementById('form-title').innerText = "Add New App";
        };

        // --- DELETE LOGIC ---
        window.deleteGame = (key) => {
            if(confirm("Are you sure you want to delete this app?")) {
                remove(ref(db, 'games/' + key))
                    .then(() => showToast("App Deleted", "success"))
                    .catch(err => showToast(err.message, "error"));
            }
        };

        // --- HELPERS ---
        window.updatePreview = () => {
            const title = document.getElementById('appName').value;
            const logo = document.getElementById('appLogo').value;
            document.getElementById('prev-title').innerText = title || "App Name";
            if(logo) document.getElementById('prev-img').src = logo;
        };

        function resetForm() {
            document.querySelectorAll('input, textarea').forEach(i => i.value = '');
            updatePreview();
        }

        function showToast(msg, type) {
            const toast = document.getElementById("toast");
            toast.innerText = msg;
            toast.className = "show " + type;
            setTimeout(() => { toast.className = ""; }, 3000);
        }

        // Expose functions globally for HTML onclick
        window.editGame = editGame;
        window.deleteGame = deleteGame;
        window.saveGame = saveGame;
        window.cancelEdit = cancelEdit;
        window.updatePreview = updatePreview;
        window.login = login;
        window.logout = logout;
    </script>
</body>
</html>