<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Console</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { margin: 0; background: #1f1f1f; color: #fff; font-family: sans-serif; display: flex; height: 100vh; }
        
        /* SIDEBAR */
        .sidebar { width: 250px; background: #282828; padding: 20px; border-right: 1px solid #333; }
        .sidebar h2 { margin-top: 0; color: #00A173; }
        .menu-link { display: block; padding: 15px; color: #aaa; text-decoration: none; border-radius: 5px; margin-bottom: 5px; }
        .menu-link:hover, .menu-link.active { background: #383838; color: white; }

        /* MAIN */
        .main { flex: 1; padding: 30px; overflow-y: auto; }
        
        /* FORM */
        input, textarea { width: 100%; background: #333; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; }
        label { display: block; color: #aaa; margin-bottom: 5px; font-size: 14px; }
        
        .btn { background: #00A173; color: black; border: none; padding: 12px 25px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .btn:hover { background: #00c48c; }

        .file-box { border: 2px dashed #444; padding: 20px; text-align: center; border-radius: 8px; cursor: pointer; margin-bottom: 15px; }
        .file-box:hover { border-color: #00A173; background: #2a2a2a; }
        .preview-img { height: 60px; margin-top: 10px; display: none; object-fit: contain; }

        /* LIST */
        .game-row { display: flex; align-items: center; background: #282828; padding: 10px; margin-bottom: 10px; border-radius: 8px; }
        .game-row img { width: 40px; height: 40px; border-radius: 8px; margin-right: 15px; }
        .game-row div { flex: 1; }
        .del-btn { background: #ff4757; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2><i class="fas fa-terminal"></i> Console</h2>
        <a href="#" class="menu-link active">Dashboard</a>
        <a href="#" class="menu-link" onclick="location.reload()">Refresh Data</a>
    </div>

    <div class="main">
        <h1>Create New Release</h1>
        
        <div style="background: #282828; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
            <label>App Name</label>
            <input type="text" id="name" placeholder="e.g. Pubg Mobile">

            <label>Icon (512x512)</label>
            <div class="file-box" onclick="document.getElementById('iconFile').click()">
                Click to Upload Icon
                <img id="iconPrev" class="preview-img">
            </div>
            <input type="file" id="iconFile" hidden accept="image/*" onchange="window.handleIcon(this)">
            <input type="hidden" id="iconBase64">

            <label>Download URL</label>
            <input type="text" id="link" placeholder="https://...">

            <label>Short Description</label>
            <textarea id="desc" rows="3"></textarea>

            <label>Screenshots</label>
            <div id="sc-container"></div>
            <button class="btn" style="background:#444; color:white; margin-bottom:15px;" onclick="window.addScField()">+ Add Screenshot</button>
            
            <br>
            <button class="btn" onclick="window.publish()">PUBLISH TO STORE</button>
        </div>

        <h2>Existing Apps</h2>
        <div id="app-list">Loading...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        // REPLACE THIS WITH YOUR CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCn1FBaxDwbvC28VWXAcq557uCidl-JHy0",
            authDomain: "app-store-6b5d4.firebaseapp.com",
            databaseURL: "https://app-store-6b5d4-default-rtdb.firebaseio.com",
            projectId: "app-store-6b5d4",
            storageBucket: "app-store-6b5d4.firebasestorage.app",
            messagingSenderId: "55022892860",
            appId: "1:55022892860:web:f48865da1539854bf8d039"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Compress Logic
        const compress = (f) => new Promise(r => { 
            const rd = new FileReader(); rd.readAsDataURL(f); 
            rd.onload = e => { 
                const i = new Image(); i.src = e.target.result; 
                i.onload = () => { 
                    const c = document.createElement('canvas'); 
                    // Resize to max 500px width for optimization
                    const s = 500/i.width; c.width = 500; c.height = i.height*s; 
                    c.getContext('2d').drawImage(i, 0, 0, c.width, c.height); 
                    r(c.toDataURL('image/jpeg', 0.8)); 
                } 
            } 
        });

        // GLOBAL HANDLERS
        window.handleIcon = async (inp) => {
            if(inp.files[0]) {
                const b64 = await compress(inp.files[0]);
                document.getElementById('iconBase64').value = b64;
                const img = document.getElementById('iconPrev');
                img.src = b64; img.style.display = 'block';
            }
        };

        window.addScField = () => {
            const id = Date.now();
            const d = document.createElement('div');
            d.innerHTML = `<input type="file" id="sc-${id}" accept="image/*" style="width:80%" onchange="window.handleSc(this)">`;
            document.getElementById('sc-container').appendChild(d);
        };

        window.handleSc = async (inp) => {
            if(inp.files[0]) {
                const b64 = await compress(inp.files[0]);
                inp.setAttribute('data-b64', b64);
                inp.style.border = "1px solid #00A173"; // Green border = success
            }
        };

        window.publish = () => {
            const name = document.getElementById('name').value;
            const logo = document.getElementById('iconBase64').value;
            const download = document.getElementById('link').value;
            const desc = document.getElementById('desc').value;
            
            // Collect screenshots
            const screenshots = [];
            document.querySelectorAll('#sc-container input').forEach(i => {
                const val = i.getAttribute('data-b64');
                if(val) screenshots.push(val);
            });

            if(!name || !download) return alert("Name and Download Link are required!");

            push(ref(db, 'games'), { name, logo, download, desc, screenshots, downloadCount: 0 })
            .then(() => {
                alert("App Published Successfully!");
                location.reload();
            });
        };

        window.deleteApp = (id) => {
            if(confirm("Delete this app?")) remove(ref(db, 'games/' + id));
        };

        // Load List
        onValue(ref(db, 'games'), snap => {
            const d = snap.val();
            const list = document.getElementById('app-list');
            list.innerHTML = "";
            if(d) {
                Object.entries(d).forEach(([k, v]) => {
                    list.innerHTML += `
                        <div class="game-row">
                            <img src="${v.logo || ''}">
                            <div>
                                <b>${v.name}</b><br>
                                <small>${v.downloadCount || 0} Downloads</small>
                            </div>
                            <button class="del-btn" onclick="window.deleteApp('${k}')">Delete</button>
                        </div>
                    `;
                });
            }
        });
    </script>
</body>
</html>$